@model IEnumerable<Tadawi.Models.Pharmacy>
@{
    ViewData["Title"] = "إدارة الصيدليات";
    Layout = "_Layout";
}

<div class="container-fluid mt-4">
    @if (TempData["Success"] != null)
    {
        <div class="alert alert-success alert-dismissible fade show rounded-pill shadow-sm mb-4" role="alert">
            <i class="fas fa-check-circle me-2"></i> @TempData["Success"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    @if (TempData["Error"] != null)
    {
        <div class="alert alert-danger alert-dismissible fade show rounded-pill shadow-sm mb-4" role="alert">
            <i class="fas fa-exclamation-triangle me-2"></i> @TempData["Error"]
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
    }
    <div class="row mb-4 align-items-center">
        <div class="col-md-6">
            <h2 class="text-primary fw-bold"><i class="fas fa-clinic-medical me-2"></i> إدارة الصيدليات</h2>
        </div>
        <div class="col-md-6 text-start">
            <a asp-action="CreatePharmacy" class="btn btn-success px-4 rounded-pill shadow-sm">
                <i class="fas fa-plus me-1"></i> إضافة صيدلية جديدة
            </a>
        </div>
    </div>

    <div class="card border-0 shadow-sm rounded-4 p-0 overflow-hidden">
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light">
                    <tr>
                        <th class="ps-4">اسم الصيدلية</th>
                        <th>رقم الهاتف</th>
                        <th>الموقع</th>
                        <th class="text-center">الإجراءات</th>
                    </tr>
                </thead>
                <tbody>
                    @if (!Model.Any())
                    {
                        <tr>
                            <td colspan="4" class="text-center py-5 text-muted">لا يوجد صيدليات مسجلة حالياً.</td>
                        </tr>
                    }
                    @foreach (var p in Model)
                    {
                        <tr>
                            <td class="ps-4 fw-bold">@p.Name</td>
                            <td class="text-muted">@p.Phone</td>
                            <td>@p.Location</td>
                            <td class="text-center">
                                <div class="btn-group">
                                    <a asp-action="EditPharmacy" asp-route-id="@p.Id"
                                        class="btn btn-outline-info btn-sm rounded-start">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a asp-action="DeletePharmacy" asp-route-id="@p.Id"
                                        class="btn btn-outline-danger btn-sm rounded-end"
                                        onclick="return confirm('هل أنت متأكد من حذف هذه الصيدلية؟')">
                                        <i class="fas fa-trash"></i>
                                    </a>
                                </div>
                                @{
                                    var pharmacyStatuses = ViewBag.PharmacyStatuses as Dictionary<int, bool>;
                                    bool isActive = pharmacyStatuses != null && pharmacyStatuses.ContainsKey(p.Id) ?
                                    pharmacyStatuses[p.Id] : true;
                                }
                                <a asp-action="DeactivatePharmacy" asp-route-id="@p.Id"
                                    class="btn btn-sm @(isActive ? "btn-outline-secondary" : "btn-outline-success") ms-2 rounded-pill px-3"
                                    onclick="return confirm('هل أنت متأكد من تغيير حالة هذه الصيدلية؟')">
                                    <i class="fas @(isActive ? "fa-ban" : "fa-check-circle") me-1"></i> @(isActive ? "إيقاف"
                                : "تفعيل")
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<style>
    .text-primary {
        color: #008080 !important;
    }
</style>
